---
title: Report on data in AusTraits
output:
  html_document:
    df_print: kable
    highlight: tango
    keep_md: no
    smart: no
    theme: yeti
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
      smooth_scroll: true
editor_options:
  chunk_output_type: console
---

Load data
```{r}
# Install dependencies as needed
# devtools::install_deps()

# Load packages and functions for this analysis
devtools::load_all()

# load data
austraits <- readRDS("data/austraits_2.1.0.9000.rds")

au_bioclim <- load_climate_data()

# match with climate data
au_sites_clim <-
  austraits$sites %>%
  filter(site_property %in% c("longitude (deg)", "latitude (deg)")) %>%
  spread(site_property, value) %>%
  rowid_to_column("ID") %>%
  rename(latitude = `latitude (deg)`, longitude = `longitude (deg)`) %>%
  mutate_at(c("latitude", "longitude"), ~suppressWarnings(as.numeric(.x))) %>%
  combine_occurence_climate(au_bioclim)
```

Select subset of traits:
```{r}
# add max height, N_area, delta13_c
# Also do for some alternatives: e.g. leaf_width, leaf_area ?
trait_names <- c("leaf_width","leaf_delta13C","leaf_N_per_area","plant_height","specific_leaf_area", "wood_density", "leaf_area", "seed_mass")

traits <- 
  austraits$traits %>%
  filter(trait_name %in% trait_names) %>%
  left_join(au_sites_clim) 

####create a new trait dataframe to only include observations with associated latitude and longitude
traits_georef <- 
  traits %>%
  drop_na(latitude,longitude)

traits_site_summary <- 
  traits %>% 
  group_by(dataset_id, trait_name, latitude, longitude, Temp, Prec) %>% 
  summarise(nspp=n_distinct(taxon_name))

```

Write some summaries about availability of data.....


Plots:

```{r eval=FALSE, fig.height=12, fig.width=6, include=FALSE}
austraits_climate_space <-
  plot_climate_space(traits, au_bioclim)

austraits_site_by_trait <-
  plot_site_map_by_trait(traits)

austraits_climate_space / austraits_site_by_trait
```

Shading of points (blue -> yellow) indicates the number of neighbouring points (e.g. there is substantial seed mass data in SE Australia)

Compare the number of observations and taxa for each trait which are **georeferenced vs. not georeferenced**.

```{r}
number_observations_per_trait<-traits %>%
  group_by(trait_name) %>%
  summarise(n_total_obs=length(value), n_total_taxa=length(unique(taxon_name)))

number_observations_per_trait_georeferenced<-traits_georef %>%
  group_by(trait_name) %>%
  summarise(n_georef_obs=length(value), n_georef_taxa=length(unique(taxon_name))) %>%
  left_join(number_observations_per_trait)

number_observations_per_trait_georeferenced %>% 
  relocate(n_total_obs, .after=trait_name) %>%
  relocate(n_total_taxa, .before=n_georef_taxa) %>%
  kbl(caption = "Table 1: n_total_obs: Total number of observations of a given trait, n_georef_obs: Number of observations of a given trait with georeference, n_total_taxa: Total number of taxa with at least one observation of a given trait, n_georef_taxa: Number of taxa with at least one georeferenced observation of a given trait") %>%
  kable_classic(full_width = T, html_font = "Cambria")  

```

How many traits out of the 8 focal traits were measured in each site?

```{r}
n_traits_site_summary<-traits_site_summary %>% 
  group_by(dataset_id, latitude, longitude, Temp, Prec) %>% 
  summarise(n_traits=n_distinct(trait_name))

n_traits_georef_site_summary<-traits_georef %>% 
  group_by(dataset_id, latitude, longitude, Temp, Prec) %>% 
  summarise(n_traits=n_distinct(trait_name))


hist(n_traits_site_summary$n_traits, xlab="Number of traits", ylab = "Sites", main = "Number of sites (total)")
hist(n_traits_georef_site_summary$n_traits, xlab="Number of traits", ylab = "Sites", main = "Number of sites (georeferenced)")

```